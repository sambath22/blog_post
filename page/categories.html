<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Categories</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../assets/css/style.css" />
    <!-- ===============boostap icon================ -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <style>
      /* Buttons */
      .btn-gradient,
      .create-btn {
        background: linear-gradient(90deg, #c084fc, #ec489a);
        color: #fff;
        border: none;
        padding: 10px 30px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-gradient:hover,
      .create-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(236, 72, 154, 0.3);
      }

      /* Modal */
      .modal-backdrop-custom {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .custom-modal {
        background: white;
        padding: 25px;
        border-radius: 20px;
        width: 600px;
        max-width: 95%;
        box-shadow: 0 0 80px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header text-center">
        <img src="../assets/img/image.png" alt="Logo" />
        Blog Post
      </div>
      <ul class="menu-sidebar">
        <li>
          <a href="index.html">
            <svg width="24" height="24" fill="none">
              <path
                d="M21 12C21 16.97 16.97 21 12 21C7.03 21 3 16.97 3 12M21 12C21 7.03 16.97 3 12 3M21 12H19M3 12C3 7.03 7.03 3 12 3M3 12H5M12 3V5M13.32 10.5C12.97 10.19 12.51 10 12 10C10.89 10 10 10.89 10 12C10 13.1 10.89 14 12 14C13.1 14 14 13.1 14 12C14 11.4 13.74 10.87 13.32 10.5ZM13.32 10.5L15.82 8"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
              ></path>
            </svg>
            Dashboard
          </a>
        </li>
        <li>
          <details open>
            <summary>
              <svg width="20" height="20" fill="none">
                <path
                  d="M7 25V2.005C7 2.005 7 1 8 1H30C30 1 31 1.005 31 2.005V28.005C31 28.005 31 31 28 31H4C4 31 1 31.005 1 27.005V12.005C1 12.005 1 11 2 11H4M13 7H18M13 11H25M13 15H25M13 19H25M13 23H25"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
              My Articles
            </summary>
            <ul>
              <li>
                <a href="../page/own_article.html" class="menu-active"
                  >All Articles</a
                >
              </li>
              <li><a href="../page/create-article.html">Create Article</a></li>
            </ul>
          </details>
        </li>
        <li>
          <a href="../page/categories.html">
            <svg width="20" height="20" fill="none">
              <path
                d="M5 10H7C9 10 10 9 10 7V5C10 3 9 2 7 2H5C3 2 2 3 2 5V7C2 9 3 10 5 10ZM17 10H19C21 10 22 9 22 7V5C22 3 21 2 19 2H17C15 2 14 3 14 5V7C14 9 15 10 17 10ZM17 22H19C21 22 22 21 22 19V17C22 15 21 14 19 14H17C15 14 14 15 14 17V19C14 21 15 22 17 22ZM5 22H7C9 22 10 21 10 19V17C10 15 9 14 7 14H5C3 14 2 15 2 17V19C2 21 3 22 5 22Z"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
            Category
          </a>
        </li>
        <li>
          <a href="../page/profile.html">
            <svg width="20" height="20" fill="none">
              <path
                d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
            Profile
          </a>
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
      <div class="topbar">
        <div class="d-flex flex-column align-items-end">
          <div class="welcome" id="welcomeMessage">Welcome, .....!</div>
          <div class="email" id="email">example@gmail.com</div>
        </div>
        <img class="avatar" id="avatar" src="" />
      </div>

      <div class="content-wrapper">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0 fw-semibold" style="color: #bb5cf6" ;>Categories</h3>
          <button class="btn create-btn" onclick="openCreateModal()">
            ➕ Create Category
          </button>
        </div>

        <input
          type="text"
          id="searchInput"
          class="form-control mb-3"
          placeholder="Search categories..."
          oninput="searchCategories()"
        />

        <table class="table table-bordered table-striped mt-3">
          <thead>
            <tr>
              <th>Category Name</th>
              <th class="text-end">Action</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Modals -->
    <div id="createModal" class="modal-backdrop-custom">
      <div class="custom-modal">
        <div class="modal-header">
          <h4>Create Category</h4>
          <button
            class="btn btn-outline-secondary"
            onclick="closeCreateModal()"
          >
            ✕
          </button>
        </div>
        <label class="form-label fw-semibold">Category Name *</label>
        <input id="createName" type="text" class="form-control mb-3" />
        <button class="btn w-100 create-btn" onclick="createCategory()">
          ➕ Create
        </button>
      </div>
    </div>

    <div id="editModal" class="modal-backdrop-custom">
      <div class="custom-modal">
        <div class="modal-header">
          <h4>Edit Category</h4>
          <button class="btn btn-outline-secondary" onclick="closeEditModal()">
            ✕
          </button>
        </div>
        <label class="form-label fw-semibold">Category Name *</label>
        <input id="editName" type="text" class="form-control mb-3" />
        <button class="btn w-100 create-btn" onclick="updateCategory()">
          Save
        </button>
      </div>
    </div>

    <script>
      const token = localStorage.getItem("token");
      let selectedID = null;
      let allCategories = [];

      fetch("http://blogs.csm.linkpc.net/api/v1/auth/profile", {
        headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
      })
        .then((res) => res.json())
        .then((data) => {
          const profile = data.data;
          document.getElementById(
            "welcomeMessage"
          ).innerText = `Welcome, ${profile.firstName} ${profile.lastName}!`;
          document.getElementById("email").innerText = profile.email;
          document.getElementById("avatar").src =
            profile.avatar || "https://via.placeholder.com/150";
        })
        .catch((err) => console.error(err));

      async function loadCategories() {
        try {
          const res = await fetch(
            "http://blogs.csm.linkpc.net/api/v1/categories?_page=1&_per_page=100",
            {
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
            }
          );
          const result = await res.json();
          allCategories = result.data?.items || [];
          displayCategories(allCategories);
        } catch (err) {
          console.error(err);
        }
      }

      function displayCategories(categories) {
        const tbody = document.getElementById("tbody");
        tbody.innerHTML = "";
        categories.forEach((cat) => {
          const row = document.createElement("tr");
          row.id = `row-${cat.id}`;
          row.innerHTML = `
          <td>${cat.name}</td>
          <td class="text-end">
            <!-- Edit button with bigger icon and no background -->
            <button class="btn p-0 me-2" onclick="openEditModal('${cat.id}', '${cat.name}')">
              <i class="bi bi-pencil-square" style="font-size: 18px; color: #404040;"></i>
            </button>

            <!-- Delete button with bigger icon and no background -->
            <button class="btn p-0" onclick="deleteCategory('${cat.id}')">
              <i class="bi bi-trash3" style="font-size: 18px; color: #404040;"></i>
            </button>
          </td>


        `;
          tbody.appendChild(row);
        });
      }

      function searchCategories() {
        const query = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const filtered = allCategories.filter((cat) =>
          cat.name.toLowerCase().includes(query)
        );
        displayCategories(filtered);
      }

      function openCreateModal() {
        document.getElementById("createModal").style.display = "flex";
      }
      function closeCreateModal() {
        document.getElementById("createModal").style.display = "none";
        document.getElementById("createName").value = "";
      }

      async function createCategory() {
        const name = document.getElementById("createName").value.trim();
        if (!name) return alert("Category name cannot be empty!");
        try {
          const res = await fetch(
            "http://blogs.csm.linkpc.net/api/v1/categories",
            {
              method: "POST",
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name }),
            }
          );
          const result = await res.json();
          if (!result.result) return alert("Failed to create category!");
          alert("Category created!");
          closeCreateModal();
          loadCategories();
        } catch (err) {
          console.error(err);
          alert("Error creating category!");
        }
      }

      function openEditModal(id, name) {
        selectedID = id;
        document.getElementById("editName").value = name;
        document.getElementById("editModal").style.display = "flex";
      }
      function closeEditModal() {
        document.getElementById("editModal").style.display = "none";
      }

      async function updateCategory() {
        const newName = document.getElementById("editName").value.trim();
        if (!newName) return alert("Category name cannot be empty!");
        try {
          const res = await fetch(
            `http://blogs.csm.linkpc.net/api/v1/categories/${selectedID}`,
            {
              method: "PUT",
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name: newName }),
            }
          );
          const result = await res.json();
          if (!result.result) return alert("Failed to update category!");
          alert("Updated successfully!");
          closeEditModal();
          loadCategories();
        } catch (err) {
          console.error(err);
          alert("Error updating category!");
        }
      }

      async function deleteCategory(id) {
        if (!confirm("Are you sure?")) return;
        try {
          const res = await fetch(
            `http://blogs.csm.linkpc.net/api/v1/categories/${id}`,
            {
              method: "DELETE",
              headers: { Authorization: "Bearer " + token },
            }
          );
          const result = await res.json();
          if (!result.result) return alert("Failed to delete category!");
          alert("Deleted!");
          loadCategories();
        } catch (err) {
          console.error(err);
          alert("Error deleting category!");
        }
      }

      loadCategories();
    </script>
  </body>
</html>
